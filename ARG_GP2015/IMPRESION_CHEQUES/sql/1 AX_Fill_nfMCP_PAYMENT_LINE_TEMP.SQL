/****** Object:  StoredProcedure [dbo].[AX_Fill_nfMCP_PAYMENT_LINE_TEMP]    Script Date: 7/16/2018 2:53:06 PM ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO

create PROCEDURE [dbo].[AX_Fill_nfMCP_PAYMENT_LINE_TEMP] 
@I_cTableName char(255) = NULL, 
@I_cOriginTable char(255) = NULL, 
@I_cBANACTID char(20) = NULL, 
@I_cCHEKBKID char(15) = NULL, 
@O_SQL_Error_State int = NULL  output 
as declare 
@vInsertStatement1 varchar(3000) 
select @O_SQL_Error_State = 0 
if @I_cOriginTable='T'
BEGIN
	select @vInsertStatement1 = 'insert into ' + rtrim(@I_cTableName) + char(13) + 
---		' SELECT MCPTYPID, NUMBERIE, MEDIOID, BANKID, DOCNUMBR, TITACCT, EMIDATE, DUEDATE, LINEAMNT, AMOUNTO, CURNCYID, STSDESCR, LNSEQNBR, CHEKBKID, BANACTID, CURRNIDX FROM ' + 
---		DB_NAME() + '.dbo.nfMCP30100 WHERE BANACTID = ' + char(39) + rtrim(@I_cBANACTID) + char(39) + ' AND  CHEKBKID = ' + char(39) + rtrim(@I_cCHEKBKID) + char(39)+ 
---	' UNION '+
		'SELECT T.BCHSOURC as MCPTYPID,T.VCHRNMBR as NUMBERIE,''CHEQUE'' as MEDIOID,B.BANKID,T.DOCNUMBR,PR.VNDCHKNM as TITACCT,T.DOCDATE as EMIDATE,T.DOCDATE as DUEDATE,T.DOCAMNT,T.DOCAMNT,T.CURNCYID,'''',16384,T.CHEKBKID,B.BANACTID,C.CURRNIDX FROM '+
		DB_NAME() + '.dbo.pm30200 T LEFT OUTER JOIN AXPM0100 ON T.DOCNUMBR = AXPM0100.DOCNUMBR LEFT JOIN nfMCP00400 B ON B.CHEKBKID=T.CHEKBKID LEFT JOIN DYNAMICS.DBO.MC40200 C ON C.CURNCYID=T.CURNCYID '+
        ' left join PM00200 pr on pr.VENDORID=t.VENDORID WHERE BANACTID = ' + char(39) + rtrim(@I_cBANACTID) + char(39) + ' AND  t.CHEKBKID = ' + char(39) + rtrim(@I_cCHEKBKID) + char(39)+'  AND T.DOCTYPE=6 AND T.PYENTTYP=0 and BCHSOURC in (''pm_payment'',''nfMCP_Payment'',''XXPM_Payment'') and t.voided=0'
		exec (@vInsertStatement1) 
END
if @I_cOriginTable='O'
BEGIN
	select @vInsertStatement1 = 'insert into ' + rtrim(@I_cTableName) + char(13) + 
		' SELECT MCPTYPID, NUMBERIE, MEDIOID, BANKID, DOCNUMBR, TITACCT, EMIDATE, DUEDATE, LINEAMNT, AMOUNTO, CURNCYID, STSDESCR, LNSEQNBR, CHEKBKID, BANACTID, CURRNIDX FROM ' + 
		DB_NAME() + '.dbo.nfMCP_PM20100 WHERE BANACTID = ' + char(39) + rtrim(@I_cBANACTID) + char(39) + ' AND  CHEKBKID = ' + char(39) + rtrim(@I_cCHEKBKID) + char(39)+ 
		' UNION '+
		'SELECT T.BCHSOURC,T.VCHRNMBR,''CHEQUE'',B.BANKID,T.DOCNUMBR,PR.VNDCHKNM,T.DOCDATE,T.DOCDATE,T.DOCAMNT,T.DOCAMNT,T.CURNCYID,'''',16384,T.CHEKBKID,B.BANACTID,C.CURRNIDX FROM '+
		DB_NAME() + '.dbo.PM20000 T LEFT OUTER JOIN AXPM0100 ON T.DOCNUMBR = AXPM0100.DOCNUMBR LEFT JOIN nfMCP00400 B ON B.CHEKBKID=T.CHEKBKID LEFT JOIN DYNAMICS.DBO.MC40200 C ON C.CURNCYID=T.CURNCYID '+
        ' left join PM00200 pr on pr.VENDORID=t.VENDORID WHERE BANACTID = ' + char(39) + rtrim(@I_cBANACTID) + char(39) + ' AND  t.CHEKBKID = ' + char(39) + rtrim(@I_cCHEKBKID) + char(39)+' AND T.DOCTYPE=6 AND T.PYENTTYP=0 and T.BCHSOURC in (''pm_payment'',''nfMCP_Payment'',''XXPM_Payment'')'
		exec (@vInsertStatement1) 
END


GRANT EXECUTE ON AX_Fill_nfMCP_PAYMENT_LINE_TEMP  TO [DYNGRP] 
GO 
